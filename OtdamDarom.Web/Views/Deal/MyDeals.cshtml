@using OtdamDarom.Web.Requests
@model IEnumerable<DealResponse>

@{
    ViewBag.Title = "Anunțurile Mele"; // Titlul paginii
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<title>@ViewBag.Title</title> @* Utilizează ViewBag.Title pentru eticheta <title> *@

<div class="container"> 
    <div class="row justify-content-center">
        <div class="col-12">
            <h4 class="mb-3">@ViewBag.Title</h4> @* Utilizează ViewBag.Title pentru titlul H4 *@
            
            @* Aici afișăm mesajele temporare (succes/eroare) *@
            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    @TempData["SuccessMessage"]
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            }
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    @TempData["ErrorMessage"]
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            }

            <div class="row">
                @if (Model != null && Model.Any())
                {
                    @* Nu mai este nevoie de OrderByDescending și Take(12) aici,
                       deoarece lista Model ar trebui să conțină deja doar anunțurile utilizatorului
                       și le putem afișa pe toate. Ordinea ar trebui să fie deja gestionată în BL. *@
                    foreach (var deal in Model) 
                    {
                        <div class="col-12 col-sm-6 col-md-4 mb-4">
                            <div class="card shadow h-100">
                                @if (!string.IsNullOrEmpty(deal.ImageURL))
                                {
                                    <img src="@Url.Content(deal.ImageURL)" class="card-img-top" alt="@deal.Name" style="height: 200px; object-fit: cover;">
                                }
                                else
                                {
                                    <img src="@Url.Content("~/Content/Images/default-deal.png")" class="card-img-top" alt="Imagine implicită" style="height: 200px; object-fit: cover;">
                                }
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title mb-1">@deal.Name</h5>
                                    <p class="card-text text-muted mb-2">@deal.Description</p>
                                    <a href="@Url.Action("Details", "Deal", new { id = deal.Id })" class="btn btn-sm btn-outline-success mt-auto">Vezi Detalii</a>
                                    
                                    @* Butoanele pentru Editare și Ștergere ar putea fi adăugate aici.
                                       Vom presupune că vei adăuga aceste acțiuni în DealController mai târziu. *@
                                    <div class="mt-2">
                                        <a href="@Url.Action("Edit", "Deal", new { id = deal.Id })" class="btn btn-sm btn-primary">Editare</a>
                                        <button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteDealModal_@deal.Id">Ștergere</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="modal fade" id="deleteDealModal_@deal.Id" tabindex="-1" role="dialog" aria-labelledby="deleteDealModalLabel_@deal.Id" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteDealModalLabel_@deal.Id">Confirmă Ștergerea</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Ești sigur că vrei să ștergi anunțul "@deal.Name"? Această acțiune este ireversibilă.
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Anulează</button>
                                        @using (Html.BeginForm("Delete", "Deal", new { id = deal.Id }, FormMethod.Post, new { @class = "d-inline" }))
                                        {
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn btn-danger">Șterge</button>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col-12">
                        <div class="alert alert-info" role="alert">
                            Nu ai postat încă niciun anunț. <a href="@Url.Action("Create", "Deal")" class="alert-link">Adaugă un anunț nou acum!</a>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>